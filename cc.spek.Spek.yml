app-id: cc.spek.Spek
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
command: spek
default-branch: stable
rename-appdata-file: spek.metainfo.xml
rename-desktop-file: spek.desktop
rename-icon: spek
cleanup:
  - /include
  - /lib/*.a
  - /lib/*.la
  - /lib/pkgconfig
  - /share/man
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --filesystem=home:ro
modules:
  - name: wxWidgets
    rm-configure: true
    cleanup:
      - /include
      - /lib/wx
      - /share/aclocal
      - /share/bakefile
    sources:
      - type: archive
        url: https://github.com/wxWidgets/wxWidgets/releases/download/v3.2.1/wxWidgets-3.2.1.tar.bz2
        sha256: c229976bb413eb88e45cb5dfb68b27890d450149c09b331abd751e7ae0f5fa66
        x-checker-data:
          type: html
          url: https://www.wxwidgets.org/downloads
          version-pattern: 'Latest Stable Release: ([\d\.-]+)'
          url-template: https://github.com/wxWidgets/wxWidgets/releases/download/v$version/wxWidgets-$version.tar.bz2

  - name: ffmpeg
    config-opts:
      - --disable-doc
      - --disable-debug
      - --disable-avdevice
      - --disable-avfilter
      - --disable-swscale
      - --disable-programs
      - --disable-network
      - --disable-muxers
      - --disable-zlib
      - --disable-bzlib
      - --disable-iconv
      - --disable-bsfs
      - --disable-filters
      - --disable-parsers
      - --disable-indevs
      - --disable-outdevs
      - --disable-encoders
      - --disable-decoders
      - --disable-hwaccels
      - --disable-nvenc
      - --disable-videotoolbox
      - --disable-audiotoolbox

      - --disable-protocols
      - --enable-protocol=file

      # Only demuxers for files that can contain audio are needed
      #- --disable-demuxers
      - --disable-demuxer=apng
      - --disable-demuxer=gif
      - --disable-demuxer=image*
      - --disable-demuxer=*sub*
      - --disable-demuxer=rawvideo

      - --enable-demuxer=aac
      - --enable-demuxer=ac3
      - --enable-demuxer=aiff
      - --enable-demuxer=ape
      - --enable-demuxer=asf
      - --enable-demuxer=au
      - --enable-demuxer=avi
      - --enable-demuxer=flac
      - --enable-demuxer=flv
      - --enable-demuxer=matroska
      - --enable-demuxer=mov
      - --enable-demuxer=m4v
      - --enable-demuxer=mp3
      - --enable-demuxer=mpc
      - --enable-demuxer=mpc8
      - --enable-demuxer=ogg
      - --enable-demuxer=pcm_alaw
      - --enable-demuxer=pcm_mulaw
      - --enable-demuxer=pcm_f64be
      - --enable-demuxer=pcm_f64le
      - --enable-demuxer=pcm_f32be
      - --enable-demuxer=pcm_f32le
      - --enable-demuxer=pcm_s32be
      - --enable-demuxer=pcm_s32le
      - --enable-demuxer=pcm_s24be
      - --enable-demuxer=pcm_s24le
      - --enable-demuxer=pcm_s16be
      - --enable-demuxer=pcm_s16le
      - --enable-demuxer=pcm_s8
      - --enable-demuxer=pcm_u32be
      - --enable-demuxer=pcm_u32le
      - --enable-demuxer=pcm_u24be
      - --enable-demuxer=pcm_u24le
      - --enable-demuxer=pcm_u16be
      - --enable-demuxer=pcm_u16le
      - --enable-demuxer=pcm_u8
      - --enable-demuxer=rm
      - --enable-demuxer=shorten
      - --enable-demuxer=tak
      - --enable-demuxer=tta
      - --enable-demuxer=wav
      - --enable-demuxer=wv
      - --enable-demuxer=xwma
      - --enable-demuxer=dsf

      - --enable-decoder=aac
      - --enable-decoder=aac_latm
      - --enable-decoder=ac3
      - --enable-decoder=alac
      - --enable-decoder=als
      - --enable-decoder=ape
      - --enable-decoder=atrac1
      - --enable-decoder=atrac3
      - --enable-decoder=eac3
      - --enable-decoder=flac
      - --enable-decoder=gsm
      - --enable-decoder=gsm_ms
      - --enable-decoder=mp1
      - --enable-decoder=mp1float
      - --enable-decoder=mp2
      - --enable-decoder=mp2float
      - --enable-decoder=mp3
      - --enable-decoder=mp3adu
      - --enable-decoder=mp3adufloat
      - --enable-decoder=mp3float
      - --enable-decoder=mp3on4
      - --enable-decoder=mp3on4float
      - --enable-decoder=mpc7
      - --enable-decoder=mpc8
      - --enable-decoder=opus
      - --enable-decoder=ra_144
      - --enable-decoder=ra_288
      - --enable-decoder=ralf
      - --enable-decoder=shorten
      - --enable-decoder=tak
      - --enable-decoder=tta
      - --enable-decoder=vorbis
      - --enable-decoder=wavpack
      - --enable-decoder=wmalossless
      - --enable-decoder=wmapro
      - --enable-decoder=wmav1
      - --enable-decoder=wmav2
      - --enable-decoder=wmavoice

      - --enable-decoder=pcm_alaw
      - --enable-decoder=pcm_bluray
      - --enable-decoder=pcm_dvd
      - --enable-decoder=pcm_f32be
      - --enable-decoder=pcm_f32le
      - --enable-decoder=pcm_f64be
      - --enable-decoder=pcm_f64le
      - --enable-decoder=pcm_lxf
      - --enable-decoder=pcm_mulaw
      - --enable-decoder=pcm_s8
      - --enable-decoder=pcm_s8_planar
      - --enable-decoder=pcm_s16be
      - --enable-decoder=pcm_s16be_planar
      - --enable-decoder=pcm_s16le
      - --enable-decoder=pcm_s16le_planar
      - --enable-decoder=pcm_s24be
      - --enable-decoder=pcm_s24daud
      - --enable-decoder=pcm_s24le
      - --enable-decoder=pcm_s24le_planar
      - --enable-decoder=pcm_s32be
      - --enable-decoder=pcm_s32le
      - --enable-decoder=pcm_s32le_planar
      - --enable-decoder=pcm_u8
      - --enable-decoder=pcm_u16be
      - --enable-decoder=pcm_u16le
      - --enable-decoder=pcm_u24be
      - --enable-decoder=pcm_u24le
      - --enable-decoder=pcm_u32be
      - --enable-decoder=pcm_u32le
      - --enable-decoder=dsd_lsbf
      - --enable-decoder=dsd_msbf
      - --enable-decoder=dsd_lsbf_planar
      - --enable-decoder=dsd_msbf_planar

      - --enable-parser=aac
      - --enable-parser=aac_latm
      - --enable-parser=ac3
      - --enable-parser=cook
      - --enable-parser=dca
      - --enable-parser=flac
      - --enable-parser=gsm
      - --enable-parser=mpegaudio
      - --enable-parser=tak
      - --enable-parser=vorbis
    cleanup:
      - /share/ffmpeg/examples
    sources:
      - type: archive
        url: https://ffmpeg.org/releases/ffmpeg-5.1.2.tar.xz
        sha256: 619e706d662c8420859832ddc259cd4d4096a48a2ce1eefd052db9e440eef3dc
        x-checker-data:
          type: anitya
          project-id: 5405
          url-template: https://ffmpeg.org/releases/ffmpeg-$version.tar.xz

  - name: spek
    buildsystem: autotools
    post-install:
      # logo with name spek is needed but will be renamed by rename-icon -> rename it here and symlink it
      - mv /app/share/icons/hicolor/scalable/apps/spek.svg /app/share/icons/hicolor/scalable/apps/cc.spek.Spek.svg
      - ln -s /app/share/icons/hicolor/scalable/apps/cc.spek.Spek.svg /app/share/icons/hicolor/scalable/apps/spek.svg
    sources:
      - type: git
        url: https://github.com/alexkay/spek
        tag: v0.8.5
        commit: bf4ea059f6f87cf0f2c379f890115173fa04ce57
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
